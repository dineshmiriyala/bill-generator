{% extends 'base.html' %}

{% block content %}
<div class="menu-container">
  <div id="mainMenu" class="menu-grid active">
    <button class="card-btn" data-target="statementsMenu">üìä Statements & Reports</button>
    <button class="card-btn" data-target="billMenu">üßæ Billing & Invoicing</button>
    <button class="card-btn" data-target="customerMenu">üë§ Customers</button>
    <button class="card-btn" data-target="inventoryMenu">üì¶ Inventory</button>
    <button class="card-btn" data-target="accountMenu">‚öôÔ∏è Account & Insights</button>
    <button class="card-btn" onclick="history.back()">‚¨ÖÔ∏è Go Back</button>
  </div>

  <!-- Billing Submenu -->
  <div id="billMenu" class="submenu" style="display:none;">
    <button class="back-btn">‚Üê Back</button>
    <a href="/select_customer" class="card-link">Create Invoice</a>
    <a href="/view_bills" class="card-link">View Invoices</a>
    <a href="/test-pre-preview" class="card-link">Invoice Layout Editor</a>
    <a href="/qr_code" class="card-link">Generate UPI QR</a>
  </div>

  <!-- Customer Submenu -->
  <div id="customerMenu" class="submenu" style="display:none;">
    <button class="back-btn">‚Üê Back</button>
    <a href="/create_customers" class="card-link">Add Customer</a>
    <a href="/view_customers" class="card-link">Customer List</a>
  </div>

  <!-- Inventory Submenu -->
  <div id="inventoryMenu" class="submenu" style="display:none;">
    <button class="back-btn">‚Üê Back</button>
    <a href="/view_inventory" class="card-link">Inventory List</a>
    <a href="/add_inventory" class="card-link">Add Item</a>
  </div>

  <!-- Statements Submenu -->
  <div id="statementsMenu" class="submenu" style="display:none;">
    <button class="back-btn">‚Üê Back</button>
    <a href="/statements_company" class="card-link">Company Statements</a>
    <a href="/statements" class="card-link">Date-wise Statements</a>
  </div>

  <!-- Account Submenu -->
  <div id="accountMenu" class="submenu" style="display:none;">
    <button class="back-btn">‚Üê Back</button>
    <a href="/recover" class="card-link">Data Recovery</a>
    <a href="/analytics" class="card-link">Business Analytics</a>
    <a href="/config" class="card-link">Account Settings</a>
    <form id="supabaseSyncForm" action="{{ url_for('supabase_sync_all') }}" method="post">
      <button type="submit" class="card-link-button">Upload All Data to Supabase</button>
    </form>
    <form action="{{ url_for('create_local_backup_copy') }}" method="post">
      <button type="submit" class="card-link-button" {% if not has_backup_location %}disabled{% endif %}>Make Local DB Copy</button>
    </form>
    {% if not has_backup_location %}
      <p class="text-muted small">Set a backup folder in Account Settings to enable local copies.</p>
    {% endif %}
  </div>
</div>

<div id="supabaseSyncOverlay" class="sync-overlay" aria-live="polite" hidden>
  <div class="sync-modal">
    <div class="sync-spinner" role="presentation"></div>
    <p class="sync-status">Preparing upload‚Ä¶</p>
    <p class="sync-subtext">This may take a minute depending on your data size.</p>
  </div>
</div>

<style>
.menu-container {
  width: 100%;
  max-width: 850px;
  margin: 10rem auto;
  font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "Helvetica Neue", sans-serif;
  text-align: center;
  background: linear-gradient(145deg, #f8f8f8, #eaeaea);
  border-radius: 18px;
  padding: 2rem;
  color: #333333;
}
/* body {
  background: #333333;
  color: #333333;
} */
.menu-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 1.2rem;
  justify-items: center;
}
.card-btn {
  width: 100%;
  padding: 1.4rem 1rem;
  font-size: 1.15rem;
  font-weight: 600;
  border-radius: 16px;
  border: 1px solid rgba(0,0,0,0.2);
  color: #fff;
  cursor: pointer;
  background: #262626;
  box-shadow: 0 6px 14px rgba(0,0,0,0.2);
  transition: all 0.3s ease;
}
.card-btn:hover {
  background: #222;
  transform: translateY(-3px);
  box-shadow: 0 8px 20px rgba(0,0,0,0.3);
}
.card-link {
  display: block;
  width: 100%;
  padding: 1rem;
  margin-bottom: 0.8rem;
  border-radius: 12px;
  text-decoration: none;
  font-size: 1.1rem;
  font-weight: 500;
  background: #262626;
  color: #fff;
  border: 1px solid rgba(0,0,0,0.2);
  box-shadow: 0 6px 14px rgba(0,0,0,0.2);
  transition: all 0.25s ease;
}
.card-link:hover {
  background: #222;
  transform: translateY(-2px);
  color: #fff;
  box-shadow: 0 8px 20px rgba(0,0,0,0.3);
}
.card-link-button {
  display: block;
  width: 100%;
  padding: 1rem;
  margin-bottom: 0.8rem;
  border-radius: 12px;
  font-size: 1.1rem;
  font-weight: 500;
  background: #262626;
  color: #fff;
  border: 1px solid rgba(0,0,0,0.2);
  box-shadow: 0 6px 14px rgba(0,0,0,0.2);
  transition: all 0.25s ease;
  cursor: pointer;
}
.card-link-button:hover:enabled {
  background: #222;
  transform: translateY(-2px);
  box-shadow: 0 8px 20px rgba(0,0,0,0.3);
}
.card-link-button:disabled {
  opacity: 0.6;
  cursor: progress;
}
.back-btn {
  background: transparent;
  color: #000;
  border: none;
  font-weight: 500;
  font-size: 1.1rem;
  margin-bottom: 1rem;
  cursor: pointer;
  transition: color 0.3s ease;
}
.back-btn:hover { color: #555; }
.sync-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.45);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 2000;
}
.sync-overlay.visible {
  display: flex;
}
.sync-modal {
  background: #ffffff;
  padding: 2rem;
  border-radius: 16px;
  box-shadow: 0 18px 40px rgba(0,0,0,0.25);
  text-align: center;
  width: min(320px, 90%);
}
.sync-spinner {
  width: 42px;
  height: 42px;
  margin: 0 auto 1rem;
  border-radius: 50%;
  border: 4px solid rgba(0,0,0,0.1);
  border-top-color: #262626;
  animation: spinner-rotate 1s linear infinite;
}
.sync-status {
  font-size: 1.05rem;
  font-weight: 500;
  color: #262626;
}
.sync-subtext {
  margin-top: 0.5rem;
  font-size: 0.92rem;
  color: #555;
}
@keyframes spinner-rotate {
  to { transform: rotate(360deg); }
}
</style>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const mainMenu = document.getElementById('mainMenu');
    const submenus = document.querySelectorAll('.submenu');

    document.querySelectorAll('.card-btn[data-target]').forEach(btn => {
      btn.addEventListener('click', () => {
        const targetId = btn.dataset.target;
        const targetMenu = document.getElementById(targetId);
        if (targetMenu) {
          mainMenu.style.display = 'none';
          submenus.forEach(sm => sm.style.display = 'none');
          targetMenu.style.display = 'block';
        }
      });
    });

    document.querySelectorAll('.back-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        btn.parentElement.style.display = 'none';
        mainMenu.style.display = 'grid';
      });
    });

    const syncForm = document.getElementById('supabaseSyncForm');
    const overlay = document.getElementById('supabaseSyncOverlay');
    const statusLabel = overlay ? overlay.querySelector('.sync-status') : null;
    if (syncForm && overlay && statusLabel) {
      syncForm.addEventListener('submit', () => {
        overlay.classList.add('visible');
        overlay.removeAttribute('hidden');
        statusLabel.textContent = 'Uploading data to Supabase‚Ä¶';
        const submitButton = syncForm.querySelector('button[type="submit"]');
        if (submitButton) {
          submitButton.disabled = true;
        }
      });
    }
  });
</script>
{% if session and session.get('persistent_notice') %}
<div class="modal fade" id="persistentNoticeModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Notice</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        {{ session.persistent_notice|safe }}
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    var noticeModal = new bootstrap.Modal(document.getElementById('persistentNoticeModal'));
    noticeModal.show();
  });
</script>
{% endif %}
{% endblock %}
