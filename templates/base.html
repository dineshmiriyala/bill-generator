<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Bill Generator</title>
  <!-- Bootstrap 5 CSS CDN -->
  <link href="{{ url_for('static', filename='css/bootstrap.min.css') }}" rel="stylesheet">
  <link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet">
  <style>
    .btn-back {
      background-color: #0056b3;
      color: #fff;
      border: none;
    }
    .btn-back:hover {
      background-color: #003f7f;
      color: #fff;
    }
    .btn-home {
      background-color: #198754;
      color: #fff;
      border: none;
    }
    .btn-home:hover {
      background-color: #146c43;
      color: #fff;
    }
  </style>
</head>
<body class="d-flex flex-column min-vh-100">

{% if not hide_navbar %}
<nav class="navbar navbar-expand-lg" style="background-color: #24292f; padding: 0.5rem 1rem;">
  <div class="container d-flex align-items-center justify-content-between w-100">
    <!-- Left side: Back + Menu -->
    <div class="d-flex align-items-center">
      {% if back_to_select_customer %}
        <a href="{{ url_for('select_customer') }}" class="btn btn-sm me-2" style="background-color: #30363d; color: #f0f6fc; border: 1px solid #484f58;">←</a>
      {% else %}
        <button class="btn btn-sm me-2" onclick="history.back()" style="background-color: #30363d; color: #f0f6fc; border: 1px solid #484f58;">←</button>
      {% endif %}
      <button class="btn btn-sm me-3" id="menuToggle"
              style="background-color: transparent; border: none; color: #f0f6fc; font-size: 1.4rem;">☰</button>
      <a class="navbar-brand fw-semibold text-white" href="/" style="font-size: 1.1rem;">Sri Lakshmi Offset Printers</a>
    </div>

    <!-- Right side: Search + Add (+) Dropdown -->
    <div class="d-flex align-items-center">
      <!-- Apple-Style Search Bar -->
      <div class="position-relative me-3" style="width: 220px;">
        <input type="search" id="globalSearch" class="form-control form-control-sm rounded-1 ps-3"
               placeholder="Search…" style="background-color: #0d1117; color: #f0f6fc; border: 1px solid #30363d; caret-color: #f0f6fc;">
        <style>
          ::placeholder {
            color: #9ca3af !important;
            opacity: 1;
          }
        </style>
        <ul id="searchResults" class="list-group position-absolute w-100 shadow-sm"
            style="z-index: 1050; display: none; top: 36px;"></ul>
      </div>

      <!-- GitHub-style "+" Dropdown -->
      <div class="dropdown">
        <button class="btn btn-sm" type="button" id="newDropdown" data-bs-toggle="dropdown" aria-expanded="false"
                style="background-color: #21262d; border: 1px solid #30363d; color: #f0f6fc; font-size: 1.3rem; line-height: 1;">
          +
        </button>
        <ul class="dropdown-menu dropdown-menu-dark shadow-sm" aria-labelledby="newDropdown" style="left: 0;">
          <li><a class="dropdown-item" href="/select_customer">New Bill</a></li>
          <li><a class="dropdown-item" href="/create_customers">New Customer</a></li>
          <li><a class="dropdown-item" href="/add_inventory">New Inventory Item</a></li>
        </ul>
      </div>

      <!-- User Dropdown -->
      <div class="dropdown me-2">
        <button class="btn btn-sm" type="button" id="userDropdown" data-bs-toggle="dropdown" aria-expanded="false"
                style="background-color: transparent; border: none; color: #f0f6fc; font-size: 1.6rem;">
          <svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" fill="currentColor" class="bi bi-person"
               viewBox="0 0 16 16">
            <path d="M8 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"/>
            <path fill-rule="evenodd"
                  d="M8 9a5 5 0 0 0-4.546 2.916C3.338 13.5 4.881 15 8 15s4.662-1.5 4.546-3.084A5 5 0 0 0 8 9z"/>
          </svg>
        </button>
        <ul class="dropdown-menu dropdown-menu-dark shadow-sm" aria-labelledby="userDropdown"
            style="min-width: 230px; left: 0;">
          <li class="dropdown-item text-white-50">Username: {{ session.get('username', 'N/A') }}</li>
          <li class="dropdown-item text-white-50">User ID: {{ session.get('user_id', 'N/A') }}</li>
          <li class="dropdown-item text-white-50">Role: {{ session.get('role', 'N/A') }}</li>
          <li><hr class="dropdown-divider"></li>
          <li><a class="dropdown-item text-danger fw-semibold" href="/logout">Logout</a></li>
          <li><a class="dropdown-item text-warning fw-semibold" href="/logout?next=/login">Change User</a></li>
        </ul>
      </div>

    </div>
  </div>
</nav>

<!-- Offcanvas Sidebar for Quick Links -->
<div class="offcanvas offcanvas-start text-bg-dark" tabindex="-1" id="offcanvasMenu" aria-labelledby="offcanvasMenuLabel">
  <div class="offcanvas-header border-bottom border-secondary">
    <h5 class="offcanvas-title" id="offcanvasMenuLabel">Quick Links</h5>
    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas" aria-label="Close"></button>
  </div>
  <div class="offcanvas-body">
    <ul class="list-unstyled">
      <li><a class="text-white text-decoration-none d-block py-2" href="/view_bills">View Bills</a></li>
      <li><a class="text-white text-decoration-none d-block py-2" href="/select_customer">Create Bill</a></li>
      <li><a class="text-white text-decoration-none d-block py-2" href="/view_customers">View Customers</a></li>
      <li><a class="text-white text-decoration-none d-block py-2" href="/view_inventory">Inventory</a></li>
      <li><a class="text-white text-decoration-none d-block py-2" href="/statements">Statements</a></li>
      <li><a class="text-white text-decoration-none d-block py-2" href="/statements_company">Company Statements</a></li>
      <li><a class="text-white text-decoration-none d-block py-2" href="/analytics">Business Analytics</a></li>
      <li><a class="text-white text-decoration-none d-block py-2" href="/recover">Data Recovery</a></li>
      <li><a class="text-white text-decoration-none d-block py-2" href="/about_user?section=about">About Application</a></li>
    </ul>
  </div>
</div>

<!-- Flash Messages -->
{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    <div class="container mt-3">
      {% for category, message in messages %}
        <div class="alert alert-{{ 'warning' if category == 'warn' else category }} alert-dismissible fade show shadow-sm" role="alert">
          {{ message }}
          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
      {% endfor %}
    </div>
  {% endif %}
{% endwith %}
{% endif %}

<main class="flex-fill">
  <div class="container py-4">
    {% block content %}{% endblock %}
  </div>
</main>

<footer class="text-muted fixed-bottom bg-light py-2">
  <div class="container text-end">
    <small>Created by MD</small>
  </div>
</footer>

<!-- Bootstrap 5 JS Bundle -->
<script src="{{ url_for('static', filename='js/bootstrap.bundle.min.js') }}"></script>

<script>
  document.addEventListener('DOMContentLoaded', function(){
    const alerts = document.querySelectorAll('.alert');
    if (alerts.length > 0) {
      setTimeout(() => {
        alerts.forEach(el => {
          try {
            bootstrap.Alert.getOrCreateInstance(el).close();
          } catch(e){}
        });
      }, 4000);
    }
  });
</script>

<script>
  const searchLinks = [
    { name: "View Bills", url: "/view_bills" },
    { name: "Create Bill", url: "/select_customer" },
    { name: "View Customers", url: "/view_customers" },
    { name: "Add Customer", url: "/create_customers" },
    { name: "Inventory List", url: "/view_inventory" },
    { name: "Add Item", url: "/add_inventory" },
    { name: "Statements (Date-wise)", url: "/statements" },
    { name: "Company Statements", url: "/statements_company" },
    { name: "Invoice Layout Editor", url: "/test-pre-preview" },
    { name: "Data Recovery", url: "/recover" },
    { name: "Data Recovery", url: "/recover" },
    { name: "Home", url: "/" },
    { name: "About Application", url: "/about_user?section=about" },
    { name: "logout", url: "/logout" },
    { name: "Change User", url: "/logout?next=/login" }
  ];

  const searchInput = document.getElementById('globalSearch');
  const searchResults = document.getElementById('searchResults');

  searchInput.addEventListener('input', () => {
    const query = searchInput.value.toLowerCase();
    searchResults.innerHTML = '';
    if (!query) {
      searchResults.style.display = 'none';
      return;
    }

    const matches = searchLinks.filter(link => link.name.toLowerCase().includes(query));
    matches.forEach(match => {
      const item = document.createElement('li');
      item.className = 'list-group-item list-group-item-action';
      item.textContent = match.name;
      item.addEventListener('click', () => {
        window.location.href = match.url;
      });
      searchResults.appendChild(item);
    });
    searchResults.style.display = matches.length ? 'block' : 'none';
  });

  document.addEventListener('click', (e) => {
    if (!searchResults.contains(e.target) && e.target !== searchInput) {
      searchResults.style.display = 'none';
    }
  });
</script>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const offcanvasEl = document.getElementById('offcanvasMenu');
    const bsOffcanvas = new bootstrap.Offcanvas(offcanvasEl);
    document.getElementById('menuToggle').addEventListener('click', () => bsOffcanvas.toggle());
  });
</script>

</body>
</html>