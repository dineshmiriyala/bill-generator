{% extends 'base.html' %}
{% set hide_navbar = True %}
{% block content %}
<div class="container py-5" style="max-width: 850px;">

  {% if date_wise %}
  <!-- Header for Date-wise Statements -->
  <div class="text-center mb-5">
    <h2 class="fw-bold text-dark mb-1">{{ APP_INFO.business.name }}</h2>
    <p class="text-muted mb-1">{{ APP_INFO.business.address }}</p>
    <p class="text-secondary mb-0">{{ APP_INFO.business.phone }} | {{ APP_INFO.business.email }}</p>
    <hr class="my-4" style="opacity:0.15;">
    <h5 class="fw-semibold mb-0">Date-wise Statement</h5>
    <small class="text-muted">From {{ start_date | datetimeformat }} — {{ end_date | datetimeformat }}</small>
  </div>

  <!-- Summary -->
  <div class="rounded-4 bg-white border p-4 shadow-sm mb-4 text-center">
    <p class="fw-semibold text-dark mb-1">Total Invoices: {{ total_invoices }}</p>
    <p class="fw-bold text-success mb-0" style="font-size: 1.4rem;">Total: INR: {{ '%.2f'|format(total_amount) }}</p>
  </div>
{% else %}
  <!-- Header for Company-wise Statements -->
  <div class="text-center mb-5">
    <h2 class="fw-bold text-dark mb-1">{{ APP_INFO.business.name }}</h2>
    <p class="text-muted mb-1">{{ APP_INFO.business.address }}</p>
    <p class="text-secondary mb-0">{{ APP_INFO.business.phone }} | {{ APP_INFO.business.email }}</p>
    <hr class="my-4" style="opacity:0.15;">
    <h5 class="fw-semibold mb-0">Statement for {{ customer_company }}</h5>
    <small class="text-muted">Period: {{ start_date | datetimeformat }} — {{ end_date | datetimeformat }}</small>
  </div>

  <!-- Company Info -->
  <div class="rounded-4 bg-white border p-4 shadow-sm mb-4">
    <div class="row">
      <div class="col-md-6">
        <p class="mb-1"><strong>Company:</strong> {{ customer_company }}</p>
        <p class="mb-0"><strong>Phone:</strong> {{ customer_phone }}</p>
      </div>
      <div class="col-md-6 text-md-end text-muted">
        <p class="fw-semibold text-dark mb-1">Total Invoices: {{ total_invoices }}</p>
        <p class="fw-bold text-success mb-0" style="font-size: 1.4rem;">Total: INR: {{ '%.2f'|format(total_amount) }}</p>
      </div>
    </div>
  </div>
{% endif %}

  <!-- Table -->
  <div class="table-responsive mt-4">
    <table class="table table-bordered table-striped align-middle">
      <thead class="table-light">
        <tr class="text-center">
          <th>Invoice No</th>
          <th>Date</th>
          {% if date_wise %}
          <th>Company</th>
          <th>Phone</th>
          {% endif %}
          <th class="text-end">Total (INR)</th>
        </tr>
      </thead>
      <tbody>
        {% for r in inv_rows %}
        <tr>
          <td>{{ r.invoice_no }}</td>
          <td>{{ r.date | datetimeformat }}</td>
          {% if date_wise %}
          <td>{{ r.company or r.customer_company or '(No Company)' }}</td>
          <td>{{ r.phone or r.customer_phone or '(No Phone)' }}</td>
          {% endif %}
          <td class="text-end">{{ '%.2f'|format(r.total) }}</td>
        </tr>
        {% endfor %}
      </tbody>
      <tfoot>
        <tr>
          {% if date_wise %}
          <td colspan="4" class="text-end fw-semibold">Total</td>
          {% else %}
          <td colspan="2" class="text-end fw-semibold">Total</td>
          {% endif %}
          <td class="text-end fw-bold">{{ '%.2f'|format(total_amount) }}</td>
        </tr>
      </tfoot>
    </table>
  </div>

  <!-- Payment Info -->
  <div class="rounded-4 bg-light p-4 shadow-sm mt-5" style="page-break-inside: avoid; break-inside: avoid;">
    <h5 class="fw-semibold mb-3 text-primary">Payment Information</h5>
    <div class="row">
      <div class="col-md-6">
        <p class="mb-1"><strong>Account Name:</strong> {{ APP_INFO.bank.account_name }}</p>
        <p class="mb-1"><strong>Bank:</strong> {{ APP_INFO.bank.bank_name }}, {{ APP_INFO.bank.branch }}</p>
        <p class="mb-1"><strong>Account No:</strong> {{ APP_INFO.bank.account_number }}</p>
        <p class="mb-1"><strong>IFSC:</strong> {{ APP_INFO.bank.ifsc }}</p>
      </div>
      <div class="col-md-6">
        <p class="mb-1"><strong>UPI ID:</strong> {{ APP_INFO.bank.upi_id }}</p>
        <p class="mb-1"><strong>PhonePe / GPay:</strong> {{ APP_INFO.business.phone }}</p>
        <p class="mt-3 small text-muted fst-italic">{{ APP_INFO.statement.disclaimer }}</p>
      </div>
    </div>
  </div>

  <!-- Print Button -->
  <div class="text-center mt-5 d-print-none">
    <button onclick="window.print()" class="btn btn-dark rounded-pill px-4 py-2 shadow-sm">
      Print Statement
    </button>
  </div>

<script>
  window.onload = function() {
    window.print();
  };
</script>
{% endblock %}
<style>
  /* Unified Bootstrap Table Styling */
  table.table td,
  table.table th {
    font-size: 0.9rem;
    padding: 0.6rem;
    vertical-align: middle;
  }

  table.table thead th {
    font-weight: 600;
  }

  table.table tbody tr:hover {
    background-color: #f5f8ff;
  }

  .table-responsive {
    border-radius: 8px;
    overflow: hidden;
    border: 1px solid #dee2e6;
  }

  @media print {
    .table {
      border: 1px solid #000 !important;
    }
    .table th, .table td {
      border: 1px solid #000 !important;
      color: #000 !important;
    }
    .table tbody tr:hover {
      background: #fff !important;
    }
  }
</style>