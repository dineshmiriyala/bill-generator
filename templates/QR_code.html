{% extends 'base.html' %}
{% block content %}
<div class="d-flex justify-content-center align-items-center vh-100">
    <div class="card shadow-lg p-4" style="max-width: 400px; width: 100%; border-radius: 12px;">
        {% if not qr_image %}
        <div class="text-center mb-4">
            <h3 class="fw-semibold" style="background: linear-gradient(90deg, #007bff, #00c6ff); -webkit-background-clip: text; color: transparent;">Generate Payment QR</h3>
            <p class="text-muted small mb-0">Enter amount and generate a UPI QR instantly</p>
        </div>
        <form action="/generate_qr" method="post" class="row g-3">
            <div class="col-12">
                <label class="form-label small text-muted mb-1">Amount</label>
                <input type="number" step="0.01" name="amount" class="form-control shadow-sm" placeholder="Enter amount" required>
            </div>

            <div class="col-12">
                <label class="form-label small text-muted mb-1">Name</label>
                <div class="input-group">
                    <input type="text" id="upiNameInput" name="upi_name" class="form-control shadow-sm" value="{{ upi_name }}" readonly>
                    <button type="button" id="editUpiNameBtn" class="btn btn-outline-secondary shadow-sm">Edit</button>
                </div>
            </div>

            <div class="col-12">

                <label class="form-label small text-muted mb-1">UPI ID</label>
                <div class="input-group">
                    <input type="text" id="upiInput" name="upi_id" class="form-control shadow-sm"
                           value="{{ upi_id }}" readonly
                           pattern="^[A-Za-z0-9.\-_]{2,}@([A-Za-z]{2,}|[A-Za-z]{2,}\.[A-Za-z]{2,})$"
                           title="Enter a valid UPI ID, e.g. username@upi or user.name@bankname">
                    <button type="button" id="editUpiBtn" class="btn btn-outline-secondary shadow-sm">Edit</button>
                </div>
                <div class="form-text">
                    If you want to change the default UPI ID permanently, go to
                    <a href="/about_user?section=about" class="text-decoration-none">User Page</a>.
                </div>
            </div>

            <div class="col-12">
                <button type="submit" class="btn btn-primary w-100 shadow-sm rounded-pill">Generate</button>
            </div>
            <div class="col-12">
                <button type="submit" name="no_amount" value="true" class="btn btn-outline-primary w-100 shadow-sm rounded-pill">QR Code Without Amount</button>
            </div>
        </form>
<script>
document.addEventListener('DOMContentLoaded', function() {
    const editBtn = document.getElementById('editUpiBtn');
    const upiInput = document.getElementById('upiInput');
    if (editBtn && upiInput) {
        editBtn.addEventListener('click', function () {
            const readOnly = upiInput.hasAttribute('readonly');
            if (readOnly) {
                upiInput.removeAttribute('readonly');
                upiInput.focus();
                editBtn.textContent = 'Save';
                editBtn.classList.remove('btn-outline-secondary');
                editBtn.classList.add('btn-success');
            } else {
                upiInput.setAttribute('readonly', true);
                editBtn.textContent = 'Edit';
                editBtn.classList.remove('btn-success');
                editBtn.classList.add('btn-outline-secondary');
            }
        });
    }

    const editNameBtn = document.getElementById('editUpiNameBtn');
    const upiNameInput = document.getElementById('upiNameInput');

    if (editNameBtn && upiNameInput) {
        editNameBtn.addEventListener('click', function () {
            const readOnly = upiNameInput.hasAttribute('readonly');
            if (readOnly) {
                upiNameInput.removeAttribute('readonly');
                upiNameInput.focus();
                editNameBtn.textContent = 'Save';
                editNameBtn.classList.remove('btn-outline-secondary');
                editNameBtn.classList.add('btn-success');
            } else {
                upiNameInput.setAttribute('readonly', true);
                editNameBtn.textContent = 'Edit';
                editNameBtn.classList.remove('btn-success');
                editNameBtn.classList.add('btn-outline-secondary');
            }
        });
    }

    // Handle "QR Code Without Amount" button
    const noAmountBtn = document.querySelector('button[name="no_amount"]');
    const amountInput = document.querySelector('input[name="amount"]');

    if (noAmountBtn && amountInput) {
        noAmountBtn.addEventListener('click', function() {
            amountInput.removeAttribute('required'); // disable required validation
            amountInput.value = ''; // clear any existing amount
            form = noAmountBtn.closest('form');
            if (form) {
                form.submit(); // submit the form immediately
            }
        });
    }
});
</script>
        {% endif %}
    </div>
</div>
{% endblock %}