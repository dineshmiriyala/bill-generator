{% extends 'base.html' %}
{% block content %}
<div class="container d-flex flex-column justify-content-center align-items-center text-center py-4">
  <h2 class="mb-4">Add New Customer</h2>

  {% if duplicate %}
    <div class="alert alert-danger text-center w-100 mx-auto" role="alert" style="max-width: 500px; margin: 0 auto;">
      A customer with this phone number already exists!
    </div>
  {% endif %}

  {% if success %}
    <div class="alert alert-success text-center w-100 mx-auto" role="alert" style="max-width: 500px; margin: 0 auto;">
      Customer added successfully!
    </div>
  {% endif %}

  <form method="POST" action="{{ next_url if next_url else '/create_customers' }}" class="w-100" style="max-width: 400px;">
    <div class="form-floating mb-3">
      <input type="text" class="form-control shadow-sm" id="company" name="company" placeholder="Company Name" value="{{ request.form.get('company','') }}">
      <label for="company">Company Name</label>
      <div class="form-text text-muted">Note: Only the company name will be displayed on the invoice.</div>
    </div>

    <div class="form-floating mb-3">
      <input type="text" class="form-control shadow-sm" id="name" name="name" placeholder="Customer Name" value="{{ request.form.get('name','') }}" required>
      <label for="name">Customer Name</label>
    </div>

    <div class="mb-3">
      <div class="row g-2 align-items-center">
        <div class="col">
          <div class="form-floating">
            <input type="tel" class="form-control shadow-sm" id="phone" name="phone" placeholder="Phone Number" value="{{ request.form.get('phone','') }}" required>
            <label for="phone">Phone Number</label>
          </div>
        </div>
        <div class="col-auto">
          <div class="form-check mt-2">
            <input class="form-check-input" type="checkbox" value="1" id="use_auto_id" name="use_auto_id" {% if request.form.get('use_auto_id') %}checked{% endif %}>
            <label class="form-check-label" for="use_auto_id">Use computer-generated ID</label>
          </div>
        </div>
      </div>
    </div>

    <div class="form-floating mb-3">
      <input type="email" class="form-control shadow-sm" id="email" name="email" placeholder="Email Address" value="{{ request.form.get('email','') }}">
      <label for="email">Email Address (optional)</label>
    </div>

    <div class="form-floating mb-3">
      <input type="text" class="form-control shadow-sm" id="gst" name="gst" placeholder="GST Number" value="{{ request.form.get('gst','') }}">
      <label for="gst">GST Number (optional)</label>
    </div>

    <div class="form-floating mb-3">
      <input type="text" class="form-control shadow-sm" id="businessType" name="businessType" placeholder="Business Type" value="{{ request.form.get('businessType','') }}">
      <label for="businessType">Business Type (optional)</label>
    </div>

    <div class="form-floating mb-4">
      <textarea class="form-control shadow-sm" placeholder="Address" id="address" name="address" style="height: 100px;">{{ request.form.get('address','') }}</textarea>
      <label for="address">Address (optional)</label>
    </div>

    <button type="submit" class="custom-btn w-100">Add Customer</button>
    <script>
      (function() {
        const cb = document.getElementById('use_auto_id');
        const phone = document.getElementById('phone');
        function sync() {
          if (!cb || !phone) return;
          if (cb.checked) {
            // remember current value to restore later
            if (!phone.dataset.prev) {
              phone.dataset.prev = phone.value || '';
            }
            phone.value = '';
            phone.setAttribute('data-was-required', phone.required ? '1' : '0');
            phone.required = false;
            phone.placeholder = 'Will be auto-generated';
            phone.disabled = true; // make it non-editable and excluded from submission
            phone.classList.add('bg-light');
          } else {
            phone.disabled = false;
            phone.classList.remove('bg-light');
            if (phone.getAttribute('data-was-required') !== '0') phone.required = true;
            phone.placeholder = 'Phone Number';
            // restore previous value if any
            if (phone.dataset.prev !== undefined) {
              phone.value = phone.dataset.prev;
              delete phone.dataset.prev;
            }
          }
        }
        document.addEventListener('DOMContentLoaded', sync);
        if (cb) cb.addEventListener('change', sync);
      })();
    </script>
  </form>
</div>
{% endblock %}