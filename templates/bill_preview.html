<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{{ invoice.invoiceId }} - Invoice</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
      body {
        font-family: 'Poppins', sans-serif;
      }
      :root {
        --hdr-fs: {{ (sizes.header if sizes is defined and sizes.header is defined else 13) }}px;
        --cust-fs: {{ (sizes.customer if sizes is defined and sizes.customer is defined else 16) }}px;
        --invinfo-fs: {{ (sizes.invoice_info if sizes is defined and sizes.invoice_info is defined else 13) }}px;
        --table-fs: {{ (sizes.table if sizes is defined and sizes.table is defined else 13) }}px;
        --totals-fs: {{ (sizes.totals if sizes is defined and sizes.totals is defined else 15) }}px;
        --payment-fs: {{ (sizes.payment if sizes is defined and sizes.payment is defined else 13) }}px;
        --footer-fs: {{ (sizes.footer if sizes is defined and sizes.footer is defined else 10) }}px;
      }
      .brand-logo {
        height: calc(var(--hdr-fs) * 4);
        width: auto;
      }
      @media print {
        .brand-logo {
          height: calc(var(--hdr-fs) * 4) !important;
          width: auto !important;
          max-width: none !important;
        }
      }
      .signature-img {
        max-width: 160px; /* reduced size */
        height: auto;
        display: block;
        margin-bottom: 0.25rem;
        user-select: none;
        -webkit-user-drag: none;
      }
      @media print {
        .signature-img { max-width: 100px; }
      }
      .payment-info { font-size: 0.95rem; }
      .signature-wrap {
        display: inline-flex;
        flex-direction: column;
        align-items: center; /* center caption to image width */
      }
      .signature-caption {
        width: 100%;
        text-align: center;
      }
      /* Extra-thin table borders (screen) */
      table.table { border-collapse: collapse; }
      .table-bordered > :not(caption) > * { border-width: 0.5px !important; }
      .table-bordered td, .table-bordered th { border-width: 0.5px !important; }
      .table { border-color: #c8c8c8 !important; }
      /* Print/PDF sizing */
      @page {
        size: A4;
        margin: 16mm;
      }
      @media print {
        body { line-height: 1.35; }
        .container { max-width: 100% !important; }
        /* Use layoutConfig sizes for print as well */
        .bill-heading { font-size: var(--hdr-fs) !important; }
        .from-to-block, .from-to-block * { font-size: var(--cust-fs) !important; }
        .invoice-info-block, .invoice-info-block * { font-size: var(--invinfo-fs) !important; }
        .items-table, .items-table th, .items-table td { font-size: var(--table-fs) !important; }
        .totals-block, .totals-block * { font-size: var(--totals-fs) !important; }
        .payment-info { font-size: var(--payment-fs) !important; }
        .footer-note, .services small, .thanks-note { font-size: var(--footer-fs) !important; }
        /* Keep logo and signature tidy for print */
        /* .brand-logo { height: 42px !important; } */
        .signature-img { max-width: 130px !important; }
        /* Ultra-thin table borders (print/PDF) */
        table.table { table-layout: auto !important; width: 100% !important; }
        .table { border-color: #b5b5b5 !important; }
        .table-bordered > :not(caption) > * { border-width: 0.4px !important; }
        .table-bordered td, .table-bordered th { border-width: 0.4px !important; }
        .services small { font-weight: 400 !important; line-height: 0.75rem !important; }
        .fs-5 { font-size: 1.15rem !important; }
        .fs-4 { font-size: 1.25rem !important; }
      }
      /* Apply layoutConfig sizes */
      .bill-heading { font-size: var(--hdr-fs) !important; }
      .masthead, .masthead *, .bill-heading { font-size: var(--hdr-fs) !important; }
      .from-to-block, .from-to-block * { font-size: var(--cust-fs) !important; }
      .invoice-info-block, .invoice-info-block * { font-size: var(--invinfo-fs) !important; }
      .items-table, .items-table th, .items-table td { font-size: var(--table-fs) !important; }
      .totals-block, .totals-block * { font-size: var(--totals-fs) !important; }
      .payment-info { font-size: var(--payment-fs) !important; }
      .footer-note, .services small, .thanks-note { font-size: var(--footer-fs) !important; }
      .bill-heading { text-align: center; margin-top:4px; font-weight:bold; color:#000; }
      .highlight-info { color:#1a2a6c; }
      .masthead { text-align: left; }
    </style>
</head>
<body class="p-5">

    <div class="container">
        <div class="masthead mb-2">
          <h1 class="visually-hidden">Sri Lakshmi Offset Printers — ESTD: 1973</h1>
          <img class="brand-logo" src="{{ url_for('static', filename='img/brand-wordmark.svg') }}" alt="Sri Lakshmi Offset Printers — ESTD: 1973">
          <h2 class="bill-heading">Bill of Supply</h2>
        </div>

        <div class="row mb-4 from-to-block">
            <div class="col-sm-6">
                <h5>From:</h5>
                <p class="fs-5">
                    <strong class="fs-4">Sri Lakshmi Offset Printers</strong><br>
                    PAMARRU, Krishna Dist - 521157<br>
                    GST: 37AVEPM5991R3ZG<br>
                    Cell: 9848992207<br>
                    email: haripress@gmail.com<br>
                </p>
                <small class="text-muted footer-note">Composition Taxable Person. Not eligible to collect Tax on supplies.</small>
            </div>
            <div class="col-sm-6 text-end">
                <h5>To:</h5>
                <p class="text-dark fs-5">
                    {% if customer.company %}<strong class="fs-4">{{ customer.company }}</strong><br>{% endif %}
                    {% if customer.address %}{{ customer["address"] }}<br>{% endif %}
                    {% if customer.gst %}GST: {{ customer["gst"] }}<br>{% endif %}
                    {% if customer.phone %}ID_No: {{ customer["phone"] }}{% endif %}
                </p>
            </div>
        </div>

        <div class="row mb-3 invoice-info-block">
            <div class="col-sm-6">
                <p class="text-dark"><strong>Invoice No:</strong> {{ invoice.invoiceId }}</p>
                <p class="text-dark"><strong>Date:</strong> {{ invoice.createdAt.strftime('%d-%m-%Y') }}</p>
            </div>
        </div>

        <table class="table table-bordered items-table">
          {% if dcno %}
          <colgroup>
            <col style="width:6%">
            <col style="width:58%">
            <col style="width:16%">
            <col style="width:10%">
            <col style="width:10%">
          </colgroup>
          {% else %}
          <colgroup>
            <col style="width:6%">
            <col style="width:64%">
            <col style="width:15%">
            <col style="width:15%">
          </colgroup>
          {% endif %}
            <thead class="table-light text-center">
                <tr>
                    <th>Serial No</th>
                    <th>Description</th>
                    {% if dcno %}<th>Delivery Challan No</th>{% endif %}
                    <th>Quantity</th>
                    <th>Amount</th>
                </tr>
            </thead>
            <tbody>
                {% for item in items %}
                <tr>
                    <td class="text-center">{{ loop.index }}</td>
                    <td class="text-start">{{ item[0] }}</td>
                    {% if dcno %}
                    <td class="text-center">{{ dc_numbers[loop.index0] if dc_numbers is defined and dc_numbers|length > loop.index0 else '' }}</td>
                    {% endif %}
                    <td class="text-center">{{ item[2] }}</td>
                    <td class="text-center"><span class="money" data-amount="{{ item[6] }}"></span></td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <div class="text-end totals-block">
            <h5>Total: ₹ <strong><span class="money" data-amount="{{ invoice.totalAmount or 0 }}"></span></strong></h5>
            {% if total_in_words %}
            <div class="text-muted" style="font-size: 0.95rem;">Amount in words: <em>{{ total_in_words }}</em></div>
            {% endif %}
        </div>

        <div class="mt-3 text-end">
          <small class="text-muted footer-note">Computer generated receipt – signature not required</small>
        </div>

        <div class="row mt-5">
          <div class="col-12 payment-info border rounded p-3 bg-light-subtle">
            <h6 class="mb-2">Payment Information</h6>
            <div>
              Account Name: <strong>Sri Lakshmi Offset Printers</strong><br>
              Bank: <strong>State Bank of India, Pamarru</strong><br>
              Account Number: <strong>38588014977</strong><br>
              IFSC: <strong>SBIN0002776</strong><br>
              PhonePe/GPay: <strong>9848992207</strong>
            </div>
          </div>
        </div>

        <hr class="my-3" style="border:0;border-top:2px solid #c8c8c8;" />
        <div class="services text-center mt-2">
          <small class="text-muted">
            Services: Multi‑colour Offset Printing • Digital Printing • Brochures • Stickers • Invitations • Pamphlets • All Printing Works
          </small>
        </div>

        <div class="text-center mt-3">
          <small class="text-muted thanks-note">
            Thank you for your business! For inquiries or bulk orders, reach us at <strong>9848992207</strong> or <strong>haripress@gmail.com</strong>.
          </small>
        </div>

        <div class="text-center mt-4 d-print-none">
            <button onclick="window.print()" class="btn btn-primary">Print / Save as PDF</button>
            <p class="mt-2 text-muted" style="font-size: 0.9rem;">Tip: Uncheck “Headers and footers” in print dialog for a clean copy.</p>
        </div>
    </div>


<script>
  (function(){
    function formatINR(n){
      const num = Number(n||0);
      return num.toLocaleString('en-IN', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
    }
    document.querySelectorAll('.money').forEach(el => {
      const v = el.getAttribute('data-amount');
      el.textContent = formatINR(v);
    });
  })();
</script>

<script>
  // Debug: log CSS variable values from :root
  const rootStyles = getComputedStyle(document.documentElement);
  console.log("LayoutConfig sizes in use:");
  console.log("Header:", rootStyles.getPropertyValue('--hdr-fs'));
  console.log("Customer:", rootStyles.getPropertyValue('--cust-fs'));
  console.log("Invoice Info:", rootStyles.getPropertyValue('--invinfo-fs'));
  console.log("Table:", rootStyles.getPropertyValue('--table-fs'));
  console.log("Totals:", rootStyles.getPropertyValue('--totals-fs'));
  console.log("Payment:", rootStyles.getPropertyValue('--payment-fs'));
  console.log("Footer:", rootStyles.getPropertyValue('--footer-fs'));
</script>

</body>
</html>